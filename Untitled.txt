<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>證照出席進度追蹤器 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .progress-transition { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .state-none { background-color: white; }
        .state-attended { background-color: #f0fdf4; border-color: #22c55e !important; }
        .state-missed { background-color: #fef2f2; border-color: #ef4444 !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- 頂部警告 Banner (僅在風險高時顯示) -->
        <div id="danger-banner" class="hidden mb-6 p-4 bg-red-600 text-white rounded-2xl shadow-lg flex items-center gap-3 animate-pulse">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
            <span class="font-bold">警告：根據目前的紀錄，您可能無法在 5/11 前完成 50 天出席要求！</span>
        </div>

        <!-- 標題與核心數據 -->
        <header class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6 mb-6">
            <div class="flex flex-col lg:flex-row justify-between gap-6">
                <div class="space-y-2">
                    <h1 class="text-3xl font-black flex items-center gap-2 text-slate-800">
                        <span class="p-2 bg-indigo-600 rounded-xl text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5-10-5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                        </span>
                        證照進度追蹤
                    </h1>
                    <p class="text-slate-500 font-medium">目標：<span class="text-indigo-600 font-bold">50 天</span>出席紀錄</p>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 flex-1 lg:max-w-3xl">
                    <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                        <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">已出席</p>
                        <p id="stat-attended" class="text-2xl font-black text-green-600">0</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                        <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">還差幾天</p>
                        <p id="stat-needed" class="text-2xl font-black text-indigo-600">50</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                        <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">已缺席</p>
                        <p id="stat-missed" class="text-2xl font-black text-red-500">0</p>
                    </div>
                    <div id="buffer-card" class="p-4 rounded-2xl border text-center transition-colors">
                        <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">還能請假</p>
                        <p id="stat-buffer" class="text-2xl font-black">--</p>
                    </div>
                </div>
            </div>

            <div class="mt-8 space-y-2">
                <div class="flex justify-between items-end">
                    <div class="space-y-1">
                        <span id="status-badge" class="px-3 py-1 bg-indigo-100 text-indigo-700 text-[10px] font-black rounded-full uppercase">進度正常</span>
                        <p id="status-detail" class="text-sm text-slate-500 font-medium">加把勁，還剩一段路！</p>
                    </div>
                    <span id="percentage-text" class="text-2xl font-black text-slate-700">0%</span>
                </div>
                <div class="w-full bg-slate-100 rounded-full h-5 overflow-hidden border border-slate-200 p-1">
                    <div id="progress-bar" class="h-full bg-indigo-500 rounded-full progress-transition w-0"></div>
                </div>
            </div>
        </header>

        <!-- 操作說明與日曆 -->
        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-5 border-b border-slate-100 bg-slate-50/50 flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <h2 class="font-bold text-slate-700 uppercase tracking-tight text-sm">出席紀錄表</h2>
                    <div class="flex items-center gap-3">
                        <div class="flex items-center gap-1 text-[10px] font-bold text-slate-500"><div class="w-3 h-3 rounded border border-slate-300"></div> 沒記錄</div>
                        <div class="flex items-center gap-1 text-[10px] font-bold text-green-600"><div class="w-3 h-3 rounded bg-green-500"></div> 出席</div>
                        <div class="flex items-center gap-1 text-[10px] font-bold text-red-500"><div class="w-3 h-3 rounded bg-red-500"></div> 缺席</div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <p class="text-[10px] font-bold text-slate-400 italic">點擊日期可切換狀態</p>
                    <button onclick="resetProgress()" class="px-4 py-2 bg-slate-100 hover:bg-red-50 text-slate-500 hover:text-red-600 text-xs font-bold rounded-xl transition-colors">重設所有數據</button>
                </div>
            </div>
            
            <div id="calendar-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-7 gap-px bg-slate-100">
                <!-- JS 生成 -->
            </div>
        </div>

        <footer class="mt-8 text-center text-slate-400 text-[11px] font-medium space-y-2">
            <p>排除：週末、週三、以及您指定的校假 (2/16-17, 3/20-4/3, 5/1)</p>
            <p class="uppercase tracking-widest text-slate-300">資料儲存於您的瀏覽器本地空間</p>
        </footer>
    </div>

    <script>
        // 設定與日期資料
        const SCHOOL_CLOSURES = [
            'Mon Feb 16 2026', 'Tue Feb 17 2026',
            'Fri Mar 20 2026', 'Mon Mar 23 2026', 'Tue Mar 24 2026', 'Wed Mar 25 2026', 'Thu Mar 26 2026', 'Fri Mar 27 2026',
            'Mon Mar 30 2026', 'Tue Mar 31 2026', 'Wed Apr 01 2026', 'Thu Apr 02 2026', 'Fri Apr 03 2026',
            'Fri May 01 2026'
        ];

        const START_DATE = new Date(2026, 0, 20);
        const END_DATE = new Date(2026, 4, 11);
        const TARGET = 50;

        // 從本地儲存讀取資料 (改為物件儲存狀態)
        // 狀態： null (未定), 'attended' (出席), 'missed' (缺席)
        let dayStates = JSON.parse(localStorage.getItem('cert-tracker-pro-states') || '{}');

        function isWeekend(date) { return date.getDay() === 0 || date.getDay() === 6; }
        function isWednesday(date) { return date.getDay() === 3; }
        
        function getIsClosed(dateStr) {
            const dateObj = new Date(dateStr);
            return SCHOOL_CLOSURES.includes(dateStr) || isWednesday(dateObj);
        }

        function generateDays() {
            const days = [];
            let current = new Date(START_DATE);
            while (current <= END_DATE) {
                if (!isWeekend(current)) {
                    days.push(new Date(current).toDateString());
                }
                current.setDate(current.getDate() + 1);
            }
            return days;
        }

        function updateUI() {
            const allWeekdays = generateDays();
            const activeSchoolDays = allWeekdays.filter(d => !getIsClosed(d));
            
            // 統計
            let attendedCount = 0;
            let missedCount = 0;
            Object.values(dayStates).forEach(status => {
                if (status === 'attended') attendedCount++;
                if (status === 'missed') missedCount++;
            });

            const neededCount = Math.max(0, TARGET - attendedCount);
            const progress = (attendedCount / TARGET) * 100;

            // 計算未來還能上的課
            const today = new Date();
            today.setHours(0,0,0,0);
            
            const futureActiveDays = activeSchoolDays.filter(d => {
                const dateObj = new Date(d);
                // 尚未決定的未來天數 (或是今天)
                return dateObj >= today && dayStates[d] !== 'attended' && dayStates[d] !== 'missed';
            });

            // 剩餘緩衝 = 未來可上課總數 - 還差的天數
            const buffer = futureActiveDays.length - neededCount;

            // 更新介面數值
            document.getElementById('stat-attended').innerText = attendedCount;
            document.getElementById('stat-needed').innerText = neededCount;
            document.getElementById('stat-missed').innerText = missedCount;
            document.getElementById('stat-buffer').innerText = buffer < 0 ? buffer : `+${buffer}`;
            document.getElementById('percentage-text').innerText = Math.round(progress) + '%';
            document.getElementById('progress-bar').style.width = Math.min(progress, 100) + '%';

            // 緩衝區警告色
            const bufferCard = document.getElementById('buffer-card');
            const dangerBanner = document.getElementById('danger-banner');
            const statusBadge = document.getElementById('status-badge');
            const statusDetail = document.getElementById('status-detail');

            if (buffer < 0) {
                bufferCard.className = "p-4 rounded-2xl border text-center bg-red-50 border-red-200 text-red-600";
                dangerBanner.classList.remove('hidden');
                statusBadge.innerText = "危險：天數不足";
                statusBadge.className = "px-3 py-1 bg-red-100 text-red-700 text-[10px] font-black rounded-full uppercase";
                statusDetail.innerText = "就算剩下的課全上，也無法達到 50 天！";
            } else if (buffer <= 2) {
                bufferCard.className = "p-4 rounded-2xl border text-center bg-amber-50 border-amber-200 text-amber-600";
                dangerBanner.classList.add('hidden');
                statusBadge.innerText = "警告：緩衝極低";
                statusBadge.className = "px-3 py-1 bg-amber-100 text-amber-700 text-[10px] font-black rounded-full uppercase";
                statusDetail.innerText = "請假次數已接近極限，請務必準時出席。";
            } else {
                bufferCard.className = "p-4 rounded-2xl border text-center bg-slate-50 border-slate-100 text-slate-700";
                dangerBanner.classList.add('hidden');
                statusBadge.innerText = "進度正常";
                statusBadge.className = "px-3 py-1 bg-indigo-100 text-indigo-700 text-[10px] font-black rounded-full uppercase";
                statusDetail.innerText = `您還可以再請假 ${buffer} 次。`;
            }

            if (attendedCount >= TARGET) {
                statusBadge.innerText = "恭喜達標";
                statusBadge.className = "px-3 py-1 bg-green-100 text-green-700 text-[10px] font-black rounded-full uppercase";
                statusDetail.innerText = "您已完成 50 天出席要求！";
            }

            // 渲染日曆
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            allWeekdays.forEach(dateStr => {
                const state = dayStates[dateStr] || null;
                const isClosed = getIsClosed(dateStr);
                const dateObj = new Date(dateStr);
                const isPassed = dateObj < today;

                const dayCard = document.createElement('div');
                let stateClass = 'state-none';
                if (state === 'attended') stateClass = 'state-attended';
                if (state === 'missed') stateClass = 'state-missed';

                dayCard.className = `p-4 flex flex-col gap-2 min-h-[90px] border-b border-r border-slate-100 transition-all relative group ${stateClass} ${
                    isClosed ? 'bg-slate-50 opacity-50 cursor-not-allowed' : 'cursor-pointer hover:shadow-inner'
                }`;

                if (!isClosed) {
                    dayCard.onclick = () => cycleState(dateStr);
                }

                // 標記「今天」
                const isToday = dateObj.toDateString() === today.toDateString();

                dayCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex flex-col">
                            <span class="text-[9px] uppercase font-black ${isToday ? 'text-indigo-600' : 'text-slate-400'}">
                                ${dateObj.toLocaleDateString('en-US', { weekday: 'short' })}
                                ${isToday ? ' • TODAY' : ''}
                            </span>
                            <span class="text-sm font-bold ${isClosed ? 'text-slate-300' : 'text-slate-700'}">
                                ${dateObj.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' })}
                            </span>
                        </div>
                        <div class="flex items-center justify-center">
                            ${renderIcon(state, isClosed)}
                        </div>
                    </div>
                    ${isClosed ? `<span class="text-[8px] font-black uppercase text-slate-300 tracking-widest mt-auto">${isWednesday(dateObj) ? '無課程' : '學校關閉'}</span>` : ''}
                    ${!isClosed && !state && isPassed ? `<span class="text-[8px] font-black uppercase text-amber-500 tracking-widest mt-auto">待確認</span>` : ''}
                `;
                grid.appendChild(dayCard);
            });
        }

        function renderIcon(state, isClosed) {
            if (isClosed) return `<svg class="w-5 h-5 text-slate-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /></svg>`;
            if (state === 'attended') return `<svg class="w-6 h-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>`;
            if (state === 'missed') return `<svg class="w-6 h-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" /></svg>`;
            return `<div class="w-6 h-6 rounded-lg border-2 border-slate-100 group-hover:border-slate-200"></div>`;
        }

        function cycleState(dateStr) {
            const currentState = dayStates[dateStr];
            if (!currentState) {
                dayStates[dateStr] = 'attended';
            } else if (currentState === 'attended') {
                dayStates[dateStr] = 'missed';
            } else {
                delete dayStates[dateStr];
            }
            localStorage.setItem('cert-tracker-pro-states', JSON.stringify(dayStates));
            updateUI();
        }

        function resetProgress() {
            if (confirm('確定要清除所有勾選紀錄與狀態嗎？此操作無法還原。')) {
                dayStates = {};
                localStorage.setItem('cert-tracker-pro-states', JSON.stringify(dayStates));
                updateUI();
            }
        }

        // 初始化
        updateUI();
        
        // 每天自動重新計算一次 (如果頁面一直開著)
        setInterval(updateUI, 1000 * 60 * 60);
    </script>
</body>
</html>